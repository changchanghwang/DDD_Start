# 응용서비스와 표현 영역

도메인 영역은 비즈니스로직이 돌아가는 아주 중요한 영역이지만 제 기능을 하려면 사용자와 도메인을 연결해 주는 매개체가 필요하다.
여기서 응용영역과 표현 영역이 사용자와 도메인을 연결해주는 매게체 역할을 한다.

- 표현영역
  - 표현 영역은 사용자 요청을 해석한다. HTTP 요청을 표현 영역에 전달하면 URL, 요청 파라미터, 쿠키, 헤더 등을 이용해 사용자가 실행하고 싶은 기능을 판별하고 기능을 제공하는 응용 서비슬르 실행한다.
- 응용 영역
  - 원하는 기능을 제공한다. (물론 도메인을 이용한 비즈니스 로직이 돌아가는 경우가 많다.)

## 응용 서비스의 역할

주로 도메인 객체 간의 흐름을 제어하며 트랜젝션 처리도 담당한다.

```ts
class someService {
  @Transactional()
  doCreate() {
    const something = new Something();

    someThingRepository.save(something);
  }
}
```

도메인로직은 넣지 않아야한다.

## 구현

### 크기

응용 서비스는 보통 다음의 두가지 방법 중 한 가지 방식으로 구현한다.

1. 1개의 서비스 클래스에 모든 기능 구현
2. 구분되는 기능별로 클래스 따로 현하기.

해당 방법은 각가의 상황에 따라서 다르다.
나의 경우에는 그렇게 크지않는 이상에는 한 클래스에서 모든걸 다 하는걸 선호하는 편이다.
다만 서비스의 기능이 너무나도 다르던가 아니면 길이가 너무 길어진다거나 (그런경우가 많~지는 않을 것 같긴하다.) 한다면 나누는 게 좋지 않을까..

### 표현영역에 의존하지 않기

request자체를 파라미터로 응용 서비스에 전달하는 것은 표현영역에 해당하는 것에 의존하는 것이기 때문에 전달하면 안된다.

## 표현 영역

표현 영역은 다음과 같은 책임을 가진다.

- 사용자가 시스템을 사용할 수 있는 흐름(화면)을 제공하고 제어한다.
- 사용자의 요청을 알맞은 응용 서비스에 전달하고 결과를 사용자에게 제공한다.
- 사용자의 세션을 관리한다.

응용 서비스가 요구하는 형식으로 사용자 요청을 변환하여 응용 서비스에게 넘겨준다.
값 검증은 응용서비스, 표현영역을 통해서 할 수 있다. 나의 경우 joi, yup, class validator 등을 이용하여 값 검증을 표현영역에서 하는 것을 선호한다.

## 권한 검사

권한 검사는 표현영역, 응용 서비스, 도메인 세 영역에서 할 수 있다.
node의 경우에는 koa, express의 middleware / nestjs의 guard를 이용하여 권한검사를 표현영역에서 하고,
도메인 영역에서도 가능할것으로 생각된다.
